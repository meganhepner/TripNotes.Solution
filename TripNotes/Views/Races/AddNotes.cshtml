@model TripNotes.Models.Race

@{
  Layout = "_Layout";
}

<h1>Race Notes<h1>
<h3>@Html.Label("Race Date "): @Html.DisplayFor(model => model.RaceDate)</h3>
<h3>@Html.DisplayFor(model => model.RaceLength)</h3>
<h3>@Html.DisplayFor(model => model.RaceClass)</h3>
<h3>@Html.DisplayFor(model => model.RaceNotes)</h3>


  @if(@Model.Horses.Count == 0)
{
  <p>This race has no horses assigned to it</p>
}
else
{
  <h2>Horses :</h2>
  <ul>
  @foreach(var join in Model.Horses)
  { 
    @using (Html.BeginForm("AddNotes", "Horses"))
    {
      <div class ="notes">
      @Html.Hidden("joinId", @join.HorseRaceId, new { @class="joinId" })
      <li>@join.Horse.HorseName</li>
      <label for="horseNotes">Notes</label>
      <input type="text" name="horseNotes" class="horseNotes"><br>
      <label for="horsePerformance">Performance</label>
      <input type="text" name="horsePerformance" class="horsePerformance"><br>
      </div>
    }
  
  }
  <input class="test btn btn-default" type="button" name="name" value="Test" />
  <input type="submit" id="btnSubmit" value="Save Notes" /><br>

</ul>
}

  @section scripts{
    <script type="text/javascript">
      $(document).ready(function(){

        function getAllHorseRaceData(){
            var alldata = [];
            $(".notes").each(function() {
              var horseRace = {};
              horseRace.Id = $(this).find(".joinId ").val();
              horseRace.RaceNotes = $(this).find(".horseNotes").val();
              horseRace.HorsePerformance = $(this).find(".horsePerformance").val();
              alldata.push(horseRace);
            });
          return alldata;
        };

        $('#btnSubmit').click(function () {
          var data = JSON.stringify(getAllHorseRaceData());
          console.log(data);
          $.ajax({
              url: '/Races/AddNotes',
              type: 'POST',
              data: { horseRace: data },
          });
        });
      }); 
    </script>
}